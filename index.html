<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø§Ù„Ø®ØªÙ…Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</title>
  <style>
    body {
      

      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      direction: rtl;
      text-align: right;
    }
    header {
      background: #0b8457;
      color: #fff;
      padding: 1.5rem;
    }
    header h1 {
      margin: 0 0 0.5rem;
      font-size: 1.6rem;
    }
    header p {
      margin: 0.2rem 0;
    }
    main {
      max-width: 900px;
      margin: 1.5rem auto 3rem;
      background: #fff;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .khatma-info {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1rem;
    }
    .khatma-info label {
      font-weight: 600;
    }
    .khatma-info input[type="number"] {
      width: 80px;
      padding: 0.3rem 0.4rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      text-align: center;
    }
    .khatma-info button {
      padding: 0.4rem 0.9rem;
      border-radius: 5px;
      border: none;
      background: #0b8457;
      color: #fff;
      cursor: pointer;
      font-weight: 600;
    }
    .khatma-info button:hover {
      background: #086845;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #e0e0e0;
      padding: 0.5rem;
      font-size: 0.95rem;
    }
    th {
      background: #f0f0f0;
    }
    tr.done {
      background: #e6f7ec;
    }
    select {
      width: 100%;
      padding: 0.3rem 0.4rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    .small {
      font-size: 0.8rem;
      color: #666;
    }
    .footer-note {
      margin-top: 1.5rem;
      font-size: 0.9rem;
      color: #555;
      line-height: 1.6;
    }
    .progress {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: #0b8457;
    }
    .add-reader {
      margin-top: 1.5rem;
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .add-reader input {
      padding: 0.3rem 0.4rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
<body style="display:none;">

<script>
  const correctPassword = "26koran13579";

  const userPassword = prompt("Bitte Passwort eingeben:");

  if (userPassword === correctPassword) {
    document.body.style.display = "block";
  } else {
    document.body.innerHTML =
      "<h2 style='text-align:center;margin-top:50px;'>Falsches Passwort</h2>";
    document.body.style.display = "block";
    throw new Error("Access denied");
  }
</script>

 

  <header>
    <h1>Ø§Ù„Ø®ØªÙ…Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</h1>

  <header>
    <h1>Ø§Ù„Ø®ØªÙ…Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</h1>
    <p>Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡</p>
    <p>Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø£Ø­Ø¨Ø© Ø§Ù„Ø£ÙƒØ§Ø±Ù… Ù†ÙØªØªØ­ Ù‡Ø°Ù‡ Ø§Ù„Ø®ØªÙ…Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø±ÙƒØ©.</p>
    <p>Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø±Ø¨ÙŠØ¹ Ù‚Ù„ÙˆØ¨Ù†Ø§ ÙˆÙ†ÙˆØ± ØµØ¯ÙˆØ±Ù†Ø§ØŒ</p>
    <p>Ø§Ù„Ù„Ù‡Ù… Ø§ØºÙØ± Ù„Ù†Ø§ ÙˆÙ„ÙˆØ§Ù„Ø¯ÙŠÙ†Ø§ ÙˆÙ„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ù„Ù…ÙŠÙ†ØŒ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ù…Ù†Ù‡Ù… ÙˆØ§Ù„Ø£Ù…ÙˆØ§ØªØŒ Ø¨Ø±Ø­Ù…ØªÙƒ ÙŠØ§ Ø£Ø±Ø­Ù… Ø§Ù„Ø±Ø§Ø­Ù…ÙŠÙ†.</p>
    <p>ÙˆØµÙ„Ù‘Ù Ø§Ù„Ù„Ù‡Ù… ÙˆØ³Ù„Ù… ÙˆØ¨Ø§Ø±Ùƒ Ø¹Ù„Ù‰ Ù†Ø¨ÙŠÙ†Ø§ Ù…Ø­Ù…Ø¯ØŒ ÙˆØ¹Ù„Ù‰ Ø¢Ù„Ù‡ ÙˆØµØ­Ø¨Ù‡ Ø£Ø¬Ù…Ø¹ÙŠÙ†.</p>
  </header>

  <main>
    <div class="khatma-info">
      <label for="khatmaNumber">Ø±Ù‚Ù… Ø§Ù„Ø®ØªÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label>
      <input type="number" id="khatmaNumber" min="1" value="1" />
      <button id="newKhatmaBtn">Ø¨Ø¯Ø¡ Ø®ØªÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
      <span class="small">ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙÙŠ Firebase Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø±Ù‘Ø§Ø¡.</span>
    </div>

    <div class="progress" id="progressText"></div>

    <!-- Alles speichern Button -->
    <div style="margin: 15px 0; text-align:center;">
      <button id="saveAllBtn" style="
        padding: 0.6rem 1.2rem;
        background:#0b8457;
        color:white;
        border:none;
        border-radius:6px;
        font-weight:600;
        cursor:pointer;
        font-size:16px;
      ">ğŸ’¾ Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
    </div>

    <table id="juzTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ø¬Ø²Ø¡</th>
          <th>Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø±Ø¦</th>
          <th>ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŸ</th>
          <th>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="add-reader">
      <label for="newReader">Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø±Ø¦ Ø¬Ø¯ÙŠØ¯:</label>
      <input type="text" id="newReader" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø±Ø¦" />
      <button id="addReaderBtn">Ø¥Ø¶Ø§ÙØ©</button>
      <span class="small">Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ø§Ø³Ù… ÙÙˆØ±Ù‹Ø§ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆÙ„Ø¯Ù‰ Ø§Ù„Ø¬Ù…ÙŠØ¹.</span>
    </div>

    <div class="footer-note">
      <p>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</p>
      <ul>
        <li>Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ù…Ø§Ù… Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ù‚Ø±Ø§Ø¡ØªÙ‡.</li>
        <li>ÙŠÙ…ÙƒÙ† Ù„Ù„Ù‚Ø§Ø±Ø¦ Ø£Ù† ÙŠØ®ØªØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø¬Ø²Ø¡ØŒ Ù„ÙƒÙ† ÙƒÙ„ Ø¬Ø²Ø¡ Ù„Ø§ ÙŠÙ‚Ø±Ø£Ù‡ Ø¥Ù„Ø§ Ø´Ø®Øµ ÙˆØ§Ø­Ø¯.</li>
        <li>Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŒ Ø¶Ø¹ Ø¹Ù„Ø§Ù…Ø© ÙÙŠ Ø®Ø§Ù†Ø© "ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŸ".</li>
        <li>ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØªÙ… Ø­ÙØ¸Ù‡ ÙˆÙ…Ø´Ø§Ø±ÙƒØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.</li>
        <li>Ù„Ø¨Ø¯Ø¡ Ø®ØªÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø¨Ø¯Ø¡ Ø®ØªÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø©".</li>
      </ul>
    </div>
  </main>

  <script type="module">
    // Firebase v9+ Ã¼ber CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      onValue,
      set,
      update
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-database.js";

    // Firebase-Konfiguration
    const firebaseConfig = {
      apiKey: "AIzaSyA97f9-izbDSRVMigBWWffVm9cTWe1rE6M",
      authDomain: "khatmaquran-53ce5.firebaseapp.com",
      projectId: "khatmaquran-53ce5",
      storageBucket: "khatmaquran-53ce5.firebasestorage.app",
      messagingSenderId: "1024095713766",
      appId: "1:1024095713766:web:8fbe7e7baf96d9c0913e27",
      measurementId: "G-67DXQD8BLT",
      databaseURL: "https://khatmaquran-53ce5-default-rtdb.europe-west1.firebasedatabase.app/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // DOM-Elemente
    const juzTableBody   = document.querySelector('#juzTable tbody');
    const khatmaInput    = document.getElementById('khatmaNumber');
    const newKhatmaBtn   = document.getElementById('newKhatmaBtn');
    const progressText   = document.getElementById('progressText');
    const newReaderInput = document.getElementById('newReader');
    const addReaderBtn   = document.getElementById('addReaderBtn');
    const saveAllBtn     = document.getElementById('saveAllBtn');

    // ZustÃ¤nde
    let readers          = [];   // Liste aller Leser
    let juzData          = {};   // Daten der Juz fÃ¼r aktuelle Khatma
    let selectElements   = [];   // Referenzen auf alle Selects
    let checkboxElements = [];   // Referenzen auf alle Checkboxen

    // Pfade
    function khatmaPath() {
      return `khatma/${khatmaInput.value}`;
    }

    function juzPath(juzNumber) {
      return `${khatmaPath()}/juz/${juzNumber}`;
    }

    function readersPath() {
      return `readers`;
    }

    // Khatma-Nummer speichern
    function saveKhatmaNumber(num) {
      return update(ref(db, "settings"), { khatmaNumber: num });
    }

    // Khatma-Nummer live aus Firebase laden
    onValue(ref(db, "settings/khatmaNumber"), (snapshot) => {
      const num = snapshot.val();
      if (num) {
        khatmaInput.value = num;
      } else {
        khatmaInput.value = 1;
      }
      // Wenn sich die Khatma-Nummer Ã¤ndert, Tabelle neu laden
      juzData = {};
      buildTable();
      listenJuz();
    });

    // Leser aus Firebase laden und live aktualisieren
    function listenReaders() {
      const rRef = ref(db, readersPath());
      onValue(rRef, (snapshot) => {
        const val = snapshot.val() || {};
        readers = Object.values(val).filter(
          n => typeof n === 'string' && n.trim() !== ''
        );
        rebuildAllSelects();
      });
    }

    // Juz-Daten fÃ¼r aktuelle Khatma live hÃ¶ren
    function listenJuz() {
      const jRef = ref(db, `${khatmaPath()}/juz`);
      onValue(jRef, (snapshot) => {
        juzData = snapshot.val() || {};
        applyJuzDataToTable();
        updateProgress();
      });
    }

    // Tabelle einmal aufbauen (30 Zeilen)
    function buildTable() {
      juzTableBody.innerHTML = '';
      selectElements = [];
      checkboxElements = [];

      for (let i = 1; i <= 30; i++) {
        const tr = document.createElement('tr');

        const tdJuz = document.createElement('td');
        tdJuz.textContent = 'Ø§Ù„Ø¬Ø²Ø¡ ' + i;

        const tdName = document.createElement('td');
        const nameSelect = document.createElement('select');
        selectElements[i] = nameSelect;

        const tdDone = document.createElement('td');
        const doneCheckbox = document.createElement('input');
        doneCheckbox.type = 'checkbox';
        checkboxElements[i] = doneCheckbox;

        const tdUpdated = document.createElement('td');
        tdUpdated.className = 'small';

        // Events
        nameSelect.addEventListener('change', () => {
          const selectedName = nameSelect.value;
          if (!selectedName) {
            updateJuz(i, { name: "", done: false });
            doneCheckbox.checked = false;
            return;
          }
          updateJuz(i, { name: selectedName });
        });

        doneCheckbox.addEventListener('change', () => {
          updateJuz(i, { done: doneCheckbox.checked });
        });

        tdName.appendChild(nameSelect);
        tdDone.appendChild(doneCheckbox);

        tr.appendChild(tdJuz);
        tr.appendChild(tdName);
        tr.appendChild(tdDone);
        tr.appendChild(tdUpdated);

        juzTableBody.appendChild(tr);
      }

      rebuildAllSelects();
      applyJuzDataToTable();
    }

    // Alle Selects mit aktueller Leser-Liste neu aufbauen
    function rebuildAllSelects() {
      for (let i = 1; i <= 30; i++) {
        const select = selectElements[i];
        if (!select) continue;

        const currentValue = juzData[i]?.name || "";

        select.innerHTML = "";

        const emptyOption = document.createElement('option');
        emptyOption.value = "";
        emptyOption.textContent = "Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø±Ø¦";
        select.appendChild(emptyOption);

        readers.forEach(n => {
          const opt = document.createElement('option');
          opt.value = n;
          opt.textContent = n;
          select.appendChild(opt);
        });

        if (currentValue) {
          select.value = currentValue;
        }
      }
    }

    // Juz-Daten aus Firebase in die Tabelle schreiben
    function applyJuzDataToTable() {
      for (let i = 1; i <= 30; i++) {
        const row = juzTableBody.children[i - 1];
        if (!row) continue;

        const data = juzData[i] || {};
        const name = data.name || "";
        const done = !!data.done;
        const updatedAt = data.updatedAt || "";

        const select = selectElements[i];
        const checkbox = checkboxElements[i];
        const updatedCell = row.querySelector('td:last-child');

        if (select) {
          if (name && readers.includes(name)) {
            select.value = name;
          } else if (name && !readers.includes(name)) {
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = name;
            select.appendChild(opt);
            select.value = name;
          } else {
            select.value = "";
          }
        }

        if (checkbox) {
          checkbox.checked = done;
        }

        row.classList.toggle('done', done);
        if (updatedCell) {
          updatedCell.textContent = updatedAt;
        }
      }
    }

    // Juz in Firebase aktualisieren
    function updateJuz(juzNumber, changes) {
      const current = juzData[juzNumber] || { name: "", done: false, updatedAt: "" };
      const updated = {
        ...current,
        ...changes,
        updatedAt: new Date().toLocaleString('de-DE')
      };
      const jRef = ref(db, juzPath(juzNumber));
      set(jRef, updated);
    }

    // Fortschritt berechnen
    function updateProgress() {
      let doneCount = 0;
      for (let i = 1; i <= 30; i++) {
        if (juzData[i]?.done) doneCount++;
      }
      const percent = Math.round((doneCount / 30) * 100);
      progressText.textContent =
        `ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ ${doneCount} Ù…Ù† 30 Ø¬Ø²Ø¡Ù‹Ø§ (${percent}Ùª) ÙÙŠ Ø§Ù„Ø®ØªÙ…Ø© Ø±Ù‚Ù… ${khatmaInput.value}.`;
    }

    // Neue Khatma starten: Nummer erhÃ¶hen + alle Juz freigeben + speichern
    newKhatmaBtn.addEventListener('click', async () => {
      const current = parseInt(khatmaInput.value || '1', 10);
      const next = current + 1;

      khatmaInput.value = next;
      await saveKhatmaNumber(next);

      const resetData = {};
      for (let i = 1; i <= 30; i++) {
        resetData[i] = {
          name: "",
          done: false,
          updatedAt: ""
        };
      }

      await set(ref(db, `${khatmaPath()}/juz`), resetData);

      juzData = resetData;
      buildTable();
      applyJuzDataToTable();
      updateProgress();
    });

    // Khatma-Wechsel per Eingabe
    khatmaInput.addEventListener('change', async () => {
      const num = parseInt(khatmaInput.value || '1', 10) || 1;
      khatmaInput.value = num;
      await saveKhatmaNumber(num);
      juzData = {};
      buildTable();
      listenJuz();
    });

    // Neuen Leser hinzufÃ¼gen
    addReaderBtn.addEventListener('click', async () => {
      const name = (newReaderInput.value || "").trim();
      if (!name) return;
      const rRef = ref(db, `${readersPath()}/${encodeURIComponent(name)}`);
      await set(rRef, name);
      newReaderInput.value = "";
    });

    // ALLES SPEICHERN BUTTON: Khatma-Nummer + alle Juz explizit speichern
    saveAllBtn.addEventListener('click', async () => {
      const khNum = parseInt(khatmaInput.value || '1', 10) || 1;

      await update(ref(db, "settings"), { khatmaNumber: khNum });

      const updates = {};
      for (let i = 1; i <= 30; i++) {
        updates[i] = {
          name: selectElements[i]?.value || "",
          done: checkboxElements[i]?.checked || false,
          updatedAt: new Date().toLocaleString('de-DE')
        };
      }

      await set(ref(db, `khatma/${khNum}/juz`), updates);

      alert("ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.");
    });

    // Initial
    buildTable();
    listenReaders();
    listenJuz();
  </script>
</body>
</html>
      









